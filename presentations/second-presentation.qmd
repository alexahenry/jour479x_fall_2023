```{r}
library(tidyverse)
```

```{r}
logs <- read_csv("https://raw.githubusercontent.com/Sports-Roster-Data/womens-volleyball/main/rosters_2023_24.csv")
```

```{r}
head(logs)
```

```{r}
logs |>
  filter(!is.na(state_clean)) |>
  select(team, hometown_clean, state_clean, name)
```

```{r}
logs |>
  group_by(state_clean) |>
  filter(!is.na(state_clean)) |>
  summarise(
    states = n()) |>
  arrange(desc(states))
```
With the new roaster data, the top ten from my first presentation has changed slightly. Wisconsin is actually now in the top 10 where I think previously they were maybe top 20. Same thing with Minn. and North Carolina. I think looking at this across all of NCAA helped in some way. Interestingly, California and Texas still lead the way by numbers. If I could find a way to break it down by division, that would be interesting. I wouldn't be surpised by the numbers if California and Texas are leading in D1. 
### Positions

```{r}
vbpositions <- logs |>
  select(position, state_clean)
```


```{r}
vbpositions_clean <- vbpositions |>
  mutate(
    clean_position = case_when (
      str_detect(position,"Middle") ~ "Middle Blocker",
      str_detect(position, "MB") ~ "Middle Blocker",
      str_detect(position, "OH") ~ "Outside Hitter",
      str_detect(position, "Outside") ~ "Outside Hitter", 
      str_detect(position, "LB") ~ "Libero", 
      str_detect(position, "L") ~ "Libero", 
      str_detect(position, "DS") ~ "Defensive Specialist", 
      str_detect(position, "Defensive") ~ "Defensive Specialist", 
      str_detect(position, "S") ~ "Setter", 
      str_detect(position, "Opposite") ~ "Opposite Hitter", 
      str_detect(position, "OPP") ~ "Opposite Hitter", 
      str_detect(position, "Right-Side") ~ "Opposite Hitter", 
      str_detect(position, "RS") ~ "Opposite Hitter", 
      str_detect(position, "Right") ~ "Opposite Hitter", 
      str_detect(position, "Rightside") ~ "Opposite Hitter", 
      .default = NA) 
  ) |> na.omit()
```
Here, I cleaned up the data. Before I did the NA omit, there were some positions where their state said NA, so I would have to assume without looking at names that those are the international players and/or a state wasn't listed. 

```{r}
vbpositions_clean |>
  group_by(state_clean, clean_position) |>
  summarise(
    positions = n()) |>
    arrange(desc(positions))
```

###Team and State

```{r}
teams <- read_csv("https://raw.githubusercontent.com/Sports-Roster-Data/womens-volleyball/main/teams.csv")
```
```{r}
logs_with_teams <- logs |> inner_join(teams, join_by("team", "ncaa_id")) 
```
```{r}
logs_with_teams <- logs |> inner_join(teams, join_by("team", "ncaa_id")) 
```

For Texas
```{r}
logs_with_teams |>
  filter(team_state == 'TX', state_clean == 'TX', division == 'I') |> 
  group_by(team) |> 
  summarize(count = n()) |> 
    arrange(desc(count))
```
For CA
```{r}
logs_with_teams |>
  filter(team_state == 'CA', state_clean == 'CA', division == 'I') |> 
  group_by(team) |> 
  summarize(count = n()) |> 
    arrange(desc(count))
```
For all schools
```{r}
logs_with_teams |>
  filter(division == "III") |> 
  group_by(team, team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```
So changing the division, it looks like smaller schools recruit in state where Divison I schools tend to go out of state to look for their talent. 

```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "Big Ten") |>
  group_by(team, team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```

```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "SEC") |>
  group_by(team, team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```
### Looking at Top Schools in NCAA Tournment 

```{r}
logs_with_teams |>
  filter(division == "I") |> 
  group_by(team) |> 
  summarize(count = n_distinct(state_clean)) |> 
    arrange(desc(count)) |> na.omit()
```
A look at unique states each school has. (keep working with this, break down between Big conference and HBCU)
Louisville
```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "ACC") |>
  filter(team == "Louisville") |>
  group_by(team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```
Pittsburgh
```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "ACC") |>
  filter(team == "Pittsburgh") |>
  group_by(team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```

Chart (come back to this)
```{r}
all_states <- logs_with_teams |>
  group_by(state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count))

ggplot() +
  geom_histogram(data=all_states, aes(y=count)) +
  facet_wrap(~state_clean)
  
```


### Per Capita 

```{r}
states <- read_csv("http://goodcsv.com/wp-content/uploads/2020/08/us-states-territories.csv")
```

```{r}
usstates <- states |>
  filter(!is.na(`Population (2019)`)) |>
  select(state) |>
  top_n(50)
```
I'm playing around with this CSV file with the states. I'm working on making sure it's just US states and not territories. The population data is from 2019, so if I can find a more updated one, I will. 
