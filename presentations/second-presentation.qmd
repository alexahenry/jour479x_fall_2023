```{r}
library(tidyverse)
library(scales)
```

```{r}
logs <- read_csv("https://raw.githubusercontent.com/Sports-Roster-Data/womens-volleyball/main/rosters_2023_cleaned.csv")
```

```{r}
head(logs)
```

```{r}
logs |>
  filter(!is.na(state_clean)) |>
  select(team, primary_position, state_clean, name)
```

```{r}
logs |>
  group_by(state_clean) |>
  filter(!is.na(state_clean)) |>
  summarise(
    states = n()) |>
  arrange(desc(states))
```
With the new roaster data, the top ten from my first presentation has changed slightly. Wisconsin is actually now in the top 10 where I think previously they were maybe top 20. Same thing with Minn. and North Carolina. I think looking at this across all of NCAA helped in some way. Interestingly, California and Texas still lead the way by numbers. If I could find a way to break it down by division, that would be interesting. I wouldn't be surprised by the numbers if California and Texas are leading in D1. 
### Positions

```{r}
vbpositions <- logs |>
  select(primary_position, state_clean) |> 
  na.omit()
```

```{r}
vbpositions |>
  group_by(primary_position, state_clean) |>
  summarise(
    positions = n()) |> 
      arrange(desc(positions))
```
So, some of these numbers aren't shocking. Outsides are the primary position and come at an abundance no matter the state. But I did find it interesting that California produced the most aobut of Middle Blockers and Setters and Texas produces the most amount DS and Right Side. I have to wonder if that's due to the fact that they are able to play year round so players are able to develop in all areas of the game sooner. 
###Team and State

```{r}
teams <- read_csv("https://raw.githubusercontent.com/Sports-Roster-Data/womens-volleyball/main/vb_teams.csv")
```


```{r}
logs_with_teams <- logs |> inner_join(teams, join_by("ncaa_id")) |>
  rename(team = team.x) |>
  select(-team.y)
```

For Texas
```{r}
logs_with_teams |>
  filter(team_state == 'TX', state_clean == 'TX', division == 'I') |> 
  group_by(team) |> 
  summarize(count = n()) |> 
    arrange(desc(count))
```
For CA
```{r}
logs_with_teams |>
  filter(team_state == 'FL', state_clean == 'FL', division == 'I') |> 
  group_by(team) |> 
  summarize(count = n()) |> 
    arrange(desc(count))
```
For all schools
```{r}
logs_with_teams |>
  filter(division == "I") |> 
  group_by(team, team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```
So changing the division, it looks like smaller schools recruit in state where Division I schools tend to go out of state to look for their talent. 

UC Davis and UC Santa Barbara both have 17 home state players. 

```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "Big Ten") |>
  filter(team_state == state_clean) |>
  group_by(team, team_state) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```

Here, in the Big Ten, Purdue has the most in state players in the Big Ten. It's interesting because their two best outsides are Chloe Chicoine and Eva Hudson who have now been named freshman of the year and earned first team recognition. So maybe, looking in state can be helpful. But in the case with Iowa, they were 0-20 in conference and only won 4 sets in conference play and they are the second highest for gaining players in-state. 

#Mutate
```{r}
logs_with_teams <- logs_with_teams |>
  mutate(in_out_state = case_when(
    team_state == state_clean ~ "IN",
    team_state != state_clean ~ "OUT",
    .default = NA
  ))

 logs_with_teams |>
   filter(conference == "SEC") |>
   group_by(team, conference, in_out_state) |>
   summarise(
     count = n()) |> 
    arrange(desc(count)) |> na.omit()
```


```{r}
logs_with_teams |>
  filter(division == "I") |>
  group_by(conference, in_out_state) |>
  summarise(
    count = n()
  ) |> arrange(desc(count)) |> na.omit()
```
So here, I found something here, the ACC actually has more out of state players in their conference than any conference in DI. FSU and Pitt share the ACC championship. Pittsburgh does not have anyone in state on their team. (FSU isn't in the data but their under previous school's column. 

### Bar Chart of domestic players
```{r}
Power_five <- c("Big Ten", "SEC", "ACC", "Pac-12", "Big 12")

logs_with_conferences <- logs_with_teams |>
  filter(!is.na(in_out_state)) |>
  filter(division == "I") |>
  group_by(conference, in_out_state, division) |> 
  summarise(
    count = n()
  ) |>
 pivot_wider(names_from = in_out_state, values_from = count) |>
  mutate(total = IN + OUT, pct_in = IN/total *100)

power_five <- logs_with_conferences |> filter(conference %in% Power_five)

ggplot() + 
  geom_bar(
    data=power_five, 
    aes(
      x=reorder(conference, -pct_in), 
      weight= pct_in
      )
    ) + 
  scale_y_continuous(labels=comma) + 
  labs(
    title="The Big 12 and Pac-12 stays in their backyard among Power 5 schools", 
    x="Conference", 
    y="Percentage of In-State Players in conference"
)
```
I think the bar chart works well here. But come to find out, the Big 12 and Pac-12 tend to stay within in their own backyards. I think this is interesting because the last few championships in recent years have been a mixed bag. Last year, Texas Longhorns won it all, Wisconsin in 2022, Kentucky in 2020 then Stanford back to back 2019 and 2018. After that it's been primarily a back and forth between Stanford, Nebraska and Penn State. But considering, I only have this year's roaster but with COVID years and eligibility, it can be assumed that some of those players from 2018 are probably still around. Of course, with the introduction of NIL and the infamous transfer portal, I would have to wonder what roasters looked like pre-NIL and COVID. Maybe back in 2019 this chart could look a little different. I don't think by much though. 

### Out of State

```{r}
Power_five <- c("Big Ten", "SEC", "ACC", "Pac-12", "Big 12")

logs_with_conferences <- logs_with_teams |>
  filter(!is.na(in_out_state)) |>
  filter(division == "I") |>
  group_by(conference, in_out_state, division) |> 
  summarise(
    count = n()
  ) |>
 pivot_wider(names_from = in_out_state, values_from = count) |>
  mutate(total = IN + OUT, pct_in = OUT/total *100)

power_five <- logs_with_conferences |> filter(conference %in% Power_five)

ggplot() + 
  geom_bar(
    data=power_five, 
    aes(
      x=reorder(conference, -pct_in), 
      weight= pct_in
      )
    ) + 
  scale_y_continuous(labels=comma) + 
  labs(
    title="The ACC and SEC value their out of state players", 
    x="Conference", 
    y="Percentage of In-State Players in conference"
)
```
The number of out-of-state roasters are going to look a little closer together than in-state but here we see that the chart is flipped. The ACC this year has their powerhouses and championship runner up, Louisville and Pittsburgh. Pittsburgh doesn't have anyone in state on their roaster, I would have to assume maybe to a coaching issue considering Maryland picked up a former player from there and that player said she didn't have a good experience with that coach. Like every sport, volleyball is a small world, if you're a bad coach or have bad coaches on staff, it gets around the state. 
### How about the HBCU?

```{r}
logs_with_teams |>
   filter(conference == "MEAC") |>
   group_by(team, conference, in_out_state) |>
   summarise(
     count = n()) |> 
    arrange(desc(count)) |> na.omit()


logs_with_teams |>
   filter(conference == "SWAC") |>
   group_by(team, conference, in_out_state) |>
   summarise(
     count = n()) |> 
    arrange(desc(count)) |> na.omit()
```


### Looking at Top Schools in NCAA Tournment 

```{r}
logs_with_teams |>
  filter(division == "I") |> 
  group_by(team) |> 
  summarize(count = n_distinct(state_clean)) |> 
    arrange(desc(count)) |> na.omit()
```
A look at unique states each school has. (keep working with this, break down between Big conference and HBCU)
Louisville
```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "ACC") |>
  filter(team == "Louisville") |>
  group_by(team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```
Pittsburgh
```{r}
logs_with_teams |>
  filter(division == "I") |> 
  filter(conference == "ACC") |>
  filter(team == "Pittsburgh") |>
  group_by(team_state, state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count)) |> na.omit()
```

### Chart (come back to this)
```{r}
all_states <- logs_with_teams |>
  group_by(state_clean) |> 
  summarize(count = n()) |> 
    arrange(desc(count))

ggplot() +
  geom_histogram(data=all_states, aes(y=count)) +
  facet_wrap(~state_clean)
  
```


### Per Capita 

```{r}
states <- read_csv("")
```
I just need to make this a csv. But my data got a little messy because I'm missing the division part of my work so I can sort it the way I want to which I think would help me with the per capita part. I think making this part maybe a beeswarm chart could be good. Other than facet wraps and bar charts for the positions is what I'm thinking would be best. 

So I think I may just need the division part back in the data and I can keep trucking along. 
